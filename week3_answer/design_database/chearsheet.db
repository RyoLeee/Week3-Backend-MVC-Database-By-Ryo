
CREATE TABLE Buku (
  ID_Buku INTEGER PRIMARY KEY AUTOINCREMENT,
  Judul TEXT NOT NULL,
  Penulis TEXT NOT NULL,
  ISBN TEXT UNIQUE,
  Tahun_Terbit INTEGER,
  Kategori TEXT,
  Jumlah_Stok INTEGER
);

CREATE TABLE Anggota (
  ID_Anggota INTEGER PRIMARY KEY AUTOINCREMENT,
  Nama TEXT NOT NULL,
  Alamat TEXT,
  No_Telepon TEXT,
  Email TEXT UNIQUE,
  Tanggal_Bergabung DATE
);

CREATE TABLE Peminjaman (
  ID_Peminjaman INTEGER PRIMARY KEY AUTOINCREMENT,
  ID_Buku INTEGER,
  ID_Anggota INTEGER,
  Tanggal_Pinjam DATE,
  Tanggal_Kembali DATE,
  Status TEXT,
  FOREIGN KEY (ID_Buku) REFERENCES Buku(ID_Buku),
  FOREIGN KEY (ID_Anggota) REFERENCES Anggota(ID_Anggota)
);

INSERT INTO Buku (Judul, Penulis, ISBN, Tahun_Terbit, Kategori, Jumlah_Stok)
VALUES
('Clean Code', 'Robert C. Martin', '9780132350884', 2008, 'Programming', 10),
('Atomic Habits', 'James Clear', '9780735211292', 2018, 'Self Development', 5),
('Node.js Dasar', 'Ryo', '111222333', 2025, 'Programming', 7);

INSERT INTO Anggota (Nama, Alamat, No_Telepon, Email, Tanggal_Bergabung)
VALUES
('Ryo', 'Jakarta', '08123', 'ryo@mail.com', '2025-01-01'),
('Budi', 'Bandung', '08222', 'budi@mail.com', '2025-01-10');

INSERT INTO Peminjaman (ID_Buku, ID_Anggota, Tanggal_Pinjam, Status)
VALUES
(1, 1, DATE('now'), 'Dipinjam');

CREATE INDEX idx_buku_judul ON Buku(Judul);
CREATE INDEX idx_anggota_nama ON Anggota(Nama);
CREATE INDEX idx_peminjaman_tanggal ON Peminjaman(Tanggal_Pinjam);

SELECT * FROM Buku;
SELECT * FROM Anggota;

SELECT Anggota.Nama, Buku.Judul, Peminjaman.Tanggal_Pinjam, Peminjaman.Status
FROM Peminjaman
JOIN Anggota ON Peminjaman.ID_Anggota = Anggota.ID_Anggota
JOIN Buku ON Peminjaman.ID_Buku = Buku.ID_Buku;

UPDATE Buku SET Jumlah_Stok = Jumlah_Stok - 1 WHERE ID_Buku = 1;

UPDATE Peminjaman
SET Tanggal_Kembali = DATE('now'), Status = 'Dikembalikan'
WHERE ID_Peminjaman = 1;

SELECT * FROM Buku WHERE Kategori = 'Programming';

SELECT * FROM Buku ORDER BY Tahun_Terbit DESC LIMIT 2;

SELECT COUNT(*) FROM Buku;
